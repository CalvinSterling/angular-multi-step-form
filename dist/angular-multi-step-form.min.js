!function(t,e){"use strict";e.module("multiStepForm",["ngAnimate","multiStepForm.templates"]),e.module("multiStepForm").directive("formStepContainer",[function(){return{restrict:"A",require:"^^multiStepContainer",scope:!1,link:function(t,e,i,n){n.setStepContainer(e)}}}]),e.module("multiStepForm").directive("formStepValidity",["$parse",function(t){return{restrict:"A",require:"^form",link:function(i,n,r,o){var s=r.formStepValidity?t(r.formStepValidity).bind(i,i):i.$setValidity;i.$watch(function(){return o.$valid},function(t){e.isDefined(t)&&s(t)})}}}]),e.module("multiStepForm").directive("multiStepContainer",["$animate","$parse","$q","multiStepForm","FormStep","formStepElement",function(t,i,n,r,o,s){return{restrict:"EA",templateUrl:function(t,i){return"multi-step-form/partials/multi-step-container-with-"+(e.isDefined(i.useFooter)?"footer":"header")+".html"},scope:!0,replace:!0,transclude:!0,controller:["$scope",function(t){this.setStepContainer=function(t){this.stepContainer=t},this.setMultiStepControlElement=function(t){this.multiStepControlElement=t}}],link:{pre:function(t,e,i){t.formSteps=t.$eval(i.steps).map(function(t){return new o(t)}),t.stepTitles=t.formSteps.map(function(t){return t.title})},post:function(n,o,l,a,c){function p(){t.leave(o),n.$destroy()}var m,u,d,h,f=l.onFinish?i(l.onFinish).bind(n,n):p,v=l.onCancel?i(l.onCancel).bind(n,n):p,S=a.stepContainer,$=r(n.$eval(l.searchId)),I=n.$eval(l.initialStep);$.augmentScope(n),$.start(n.formSteps).then(f,v,function(i){var r=i.newStep,o=i.oldStep,l=e.isDefined(o)?o>r?"step-backward":"step-forward":"step-initial",a=n.formSteps[r-1],c=s(a,$,n);S.removeClass("step-forward step-backward step-initial").addClass(l),m&&t.cancel(m),u&&t.cancel(u),d&&d.$destroy(),h&&(m=t.leave(h)),c.then(function(e){d=e.scope,h=e.element,u=t.enter(h,S)},function(){throw new Error("Could not load step "+r)})}),$.setInitialIndex(I),c(n,function(t){a.multiStepControlElement.empty(),a.multiStepControlElement.append(t)})}}}}]),e.module("multiStepForm").directive("multiStepControlElement",[function(){return{restrict:"A",require:"^^multiStepContainer",scope:!1,link:function(t,e,i,n){n.setMultiStepControlElement(e)}}}]),e.module("multiStepForm").factory("formStepElement",["$compile","$controller","$http","$injector","$q","$templateCache",function(t,i,n,r,o,s){function l(t){if(t.template)return e.isFunction(t.template)||e.isArray(t.template)?r.$invoke(t.template):t.template;e.isFunction(t.templateUrl)||e.isArray(t.templateUrl)?r.$invoke(t.templateUrl):t.templateUrl;return n.get(t.templateUrl,{cache:s})}function a(t,e,i){var n=t.$new(e.isolatedScope);return i.augmentScope(n),n}return function(n,s,c){var p,m=e.element("<div>").addClass("form-step"),u={};return u.$template=l(n),e.forEach(n.resolve,function(t,e){u[e]=r.invoke(t)}),o.all(u).then(function(r){r=e.extend({},n.locals,r),r.$template=r.$template.data||r.$template,m.html(r.$template);var o=a(c,n,s);return n.controller&&(r.$scope=o,r.multiStepFormInstance=s,n.isolatedScope&&(r.multiStepFormScope=c),p=i(n.controller,r),m.data("$stepController",p)),t(m)(o),{element:m,scope:o}})}}]),e.module("multiStepForm").factory("FormStep",[function(){return function(t){if(!t.template&&!t.templateUrl)throw new Error("Either template or templateUrl properties have to be provided for multi step form"+t.title);this.title=t.title,this.data=t.data|{},this.controller=t.controller,this.template=t.template,this.templateUrl=t.templateUrl,this.isolatedScope=t.isolatedScope||!1,this.resolve=t.resolve||{},this.locals=t.locals||{},this.hasForm=t.hasForm||!1,this.valid=!1,this.visited=!1}}]),e.module("multiStepForm").factory("multiStepForm",["$q","$location","$rootScope",function(t,i,n){function r(r){var o=this;this.searchId=r,e.isDefined(r)&&n.$on("$locationChangeSuccess",function(t){var e=parseInt(i.search()[o.searchId]);isNaN(e)||o.activeIndex===e||o.setActiveIndex(parseInt(e))}),this.steps=[],this.deferred=t.defer(),this.start=function(t){if(!t||!t.length)throw new Error("At least one step has to be defined");return this.steps=t,this.deferred.promise},this.cancel=function(){this.deferred.reject("cancelled")},this.finish=function(){this.deferred.resolve()},this.getActiveIndex=function(){return this.activeIndex},this.setInitialIndex=function(t){var n;return e.isDefined(t)?this.setActiveIndex(t):this.searchId&&(n=parseInt(i.search()[o.searchId]),!isNaN(n))?this.setActiveIndex(n):void this.setActiveIndex(1)},this.setActiveIndex=function(t){this.searchId&&i.search(this.searchId,t),this.deferred.notify({newStep:t,oldStep:this.activeIndex}),this.activeIndex=t},this.getActiveStep=function(){return this.activeIndex?this.steps[this.activeIndex-1]:void 0},this.isFirst=function(){return 1===this.activeIndex},this.isLast=function(){return this.activeIndex===this.steps.length},this.nextStep=function(){this.isLast()||this.setActiveIndex(this.activeIndex+1)},this.previousStep=function(){this.isFirst()||this.setActiveIndex(this.activeIndex-1)},this.setValidity=function(t,e){var i=this.steps[(e||this.activeIndex)-1];i&&(i.valid=t)},this.augmentScope=function(t){var e=this;["cancel","finish","getActiveIndex","setActiveIndex","getActiveStep","nextStep","previousStep","isFirst","isLast","setValidity"].forEach(function(i){t["$"+i]=e[i].bind(e)})}}return function(t){return new r(t)}}]),function(t){try{t=e.module("multiStepForm.templates")}catch(i){t=e.module("multiStepForm.templates",[])}t.run(["$templateCache",function(t){t.put("multi-step-form/partials/multi-step-container-with-footer.html","<section class=multi-step-container><article class=multi-step-body form-step-container></article><footer class=multi-step-footer multi-step-control-element></footer></section>")}])}(),function(t){try{t=e.module("multiStepForm.templates")}catch(i){t=e.module("multiStepForm.templates",[])}t.run(["$templateCache",function(t){t.put("multi-step-form/partials/multi-step-container-with-header.html","<section class=multi-step-container><header class=multi-step-header multi-step-control-element></header><article class=multi-step-body form-step-container></article></section>")}])}()}(window,window.angular);